<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Interview Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="../assets/js/include.js"></script>
  <link href="../assets/css/interview-details.css" rel="stylesheet">
</head>
<body>
     <div id="navbar-placeholder"></div>
    <script>
        includeHtml('navbar-placeholder', '../components/navbar.html');
    </script>
   
  <div class="main-container">
    <div id="loading-spinner" class="text-center">
      <div class="spinner-border" role="status"></div>
    </div>
    <div id="detail-content" class="d-none">
      <div class="header">
        <h1 id="position-open"></h1>
        <div id="company-location" class="meta"></div>
      </div>
      <div class="section">
        <p><strong>Job Type:</strong> <span id="job-type"></span></p>
        <p><strong>Rounds:</strong> <span id="rounds-count"></span></p>
        <p><strong>Posted:</strong> <span id="start-date"></span></p>
        <h2>Description</h2>
        <p id="job-description"></p>
      </div>
      <button id="apply-btn" class="btn btn-lg btn-primary">Apply Now</button>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(function() {
      function getQueryParam(name) {
        return new URLSearchParams(window.location.search).get(name);
      }
      const interviewId = getQueryParam('interview_id');
      if (!interviewId) {
        $('.main-container').html('<div class="alert alert-danger">No interview specified.</div>');
        return;
      }
      $.ajax({
        url: 'http://localhost/Server/get_interview_details.php',
        type: 'GET',
        data: { interview_id: interviewId },
        dataType: 'json',
        success(response) {
          $('#loading-spinner').hide();
          if (response.status !== 'success') {
            $('.main-container').html(`<div class="alert alert-danger">${response.message}</div>`);
            return;
          }
          const item = response.data;
          $('#position-open').text(item.position_open);
          $('#company-location').text(`${item.company_name} Â· ${item.location}`);
          $('#job-type').text(item.job_type);
          $('#rounds-count').text(item.rounds_count);
          $('#start-date').text(item.start);
          $('#job-description').text(item.job_description);

          const btn = $('#apply-btn');
          if (item.is_applied) {
            btn.text('Applied').prop('disabled', true).removeClass('btn-primary').addClass('btn-success');
          } else {
            btn.on('click', function() {
              btn.prop('disabled', true).text('Applying...');
              $.ajax({
                url: 'http://localhost/Server/apply_interview.php',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ interview_id: interviewId }),
                success(res) {
                  if (res.status === 'success') {
                    btn.text('Applied').removeClass('btn-primary').addClass('btn-success');
                  } else {
                    alert(res.message);
                    btn.prop('disabled', false).text('Apply Now');
                  }
                },
                error() {
                  alert('Failed to apply. Try again.');
                  btn.prop('disabled', false).text('Apply Now');
                }
              });
            });
          }

          $('#detail-content').removeClass('d-none');
        },
        error() {
          $('#loading-spinner').hide();
          $('.main-container').html('<div class="alert alert-danger">Failed to load details.</div>');
        }
      });
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
